(function(t,e){"object"===typeof exports&&"object"===typeof module?module.exports=e(require("vue")):"function"===typeof define&&define.amd?define([],e):"object"===typeof exports?exports["vue2-image-spotlight"]=e(require("vue")):t["vue2-image-spotlight"]=e(t["Vue"])})("undefined"!==typeof self?self:this,(function(t){return function(){var e={40:function(t,e,i){var n={"./SpongeBob.jpg":300,"./mountain.jpg":544,"./mountain_vertical.jpg":651,"./transparent-background.png":541};function a(t){var e=s(t);return i(e)}function s(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}a.keys=function(){return Object.keys(n)},a.resolve=s,t.exports=a,a.id=40},300:function(t,e,i){"use strict";t.exports=i.p+"img/SpongeBob.907a24e1.jpg"},544:function(t,e,i){"use strict";t.exports=i.p+"img/mountain.1a1cd5c1.jpg"},651:function(t,e,i){"use strict";t.exports=i.p+"img/mountain_vertical.7531d334.jpg"},541:function(t){"use strict";t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAAA3NCSVQICAjb4U/gAAAABlBMVEXMzMz////TjRV2AAAACXBIWXMAAArrAAAK6wGCiw1aAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M26LyyjAAAABFJREFUCJlj+M/AgBVhF/0PAH6/D/HkDxOGAAAAAElFTkSuQmCC"},203:function(e){"use strict";e.exports=t}},i={};function n(t){var a=i[t];if(void 0!==a)return a.exports;var s=i[t]={exports:{}};return e[t](s,s.exports,n),s.exports}!function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){n.p=""}();var a={};return function(){"use strict";if(n.r(a),n.d(a,{default:function(){return L}}),"undefined"!==typeof window){var t=window.document.currentScript,e=t&&t.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);e&&(n.p=e[1])}var i=function(){var t=this,e=t._self._c;return e("div",{ref:"canvas-box",attrs:{id:"main"}},[e("canvas",{ref:"canvas-pic",attrs:{id:"canvas-pic",width:"500",height:"400"}}),e("canvas",{ref:"canvas-masking",attrs:{id:"canvas-masking",width:"500",height:"400"}}),e("div",{ref:"description-box",staticClass:"description-box-down"},[e("div",{staticStyle:{"font-size":"large","font-weight":"bolder","margin-bottom":"8px"}},[t._v(" "+t._s(t.allAreaInfos.length>0&&t.selectingIndex>=0?t.allAreaInfos[t.selectingIndex].name:"")+" ")]),e("div",{staticStyle:{"text-indent":"2em"}},[t._v(t._s(t.selectingIndex>=0&&t.allAreaInfos.length>0&&t.allAreaInfos[t.selectingIndex].description.trim().length>0?t.allAreaInfos[t.selectingIndex].description:"暂无注释。")+" ")])])])},s=[],o=n(203);const r=(t,e,i,n,a)=>{let s=e.length,o=!1;for(let r=0,c=s-1;r<s;c=r++){let s=l(e[r].x,i,n),h=l(e[r].y,i,a),f=l(e[c].x,i,n),g=l(e[c].y,i,a),d=h>t.y!==g>t.y&&t.x<(f-s)*(t.y-h)/(g-h)+s;d&&(o=!o)}return o},l=(t,e,i)=>t*e+i,c=t=>n(40)(`./${t}`),h=(t,e)=>{let i,n=e.length;if(!t)return t;let a=JSON.parse(JSON.stringify(t));for(i=0;"object"===typeof a&&i<n;++i)a=a[e[i]];return a},f=(t,e)=>{const i={...t};for(const n in e)e.hasOwnProperty(n)&&(g(t[n])&&g(e[n])?i[n]=f(t[n],e[n]):null==i[n]&&(i[n]=e[n]));return i},g=t=>t&&"object"===typeof t&&!Array.isArray(t);var d={isPointInPolygon:r,getImage:c,accessObjectSafely:h,mergeObjects:f};const u={canvasWidth:500,canvasHeight:400,maskBackground:"rgba(0,0,0,0.5)",animationTime:25,showDescriptionBox:!0,descriptionBoxStyle:{background:"#EBEBE3",color:"#59594F"}};var p={DefaultConfiguration:u},m={name:"ImageSpotlightRenderer",props:{imgUrl:{type:String,required:!0},allAreaInfos:{type:Array,default:()=>[]},allPoints:{type:Array,default:()=>[]},canvasWidth:{type:Number,default:500},canvasHeight:{type:Number,default:400},maskBackground:{type:String,default:"rgba(0,0,0,0.5)"},animationTime:{type:Number,default:25},showDescriptionBox:{type:Boolean,default:!0},descriptionBoxStyle:{type:Object,default:()=>({background:"#EBEBE3",color:"#59594F"})}},data(){return{finalConfiguration:null,img:null,canvas:null,context:null,scale:1,offsetX:0,offsetY:0,selecting:!1,selectingIndex:0,cursorPosition:{x:0,y:0},timer:null,descriptionBox:null}},methods:{selfAdaptionImage(){let t=1*this.img.width/this.img.height;if(t>this.finalConfiguration.canvasWidth/this.finalConfiguration.canvasHeight){this.finalConfiguration.canvasWidth;this.scale=this.finalConfiguration.canvasWidth/this.img.width,this.offsetX=0,this.offsetY=0}else{this.finalConfiguration.canvasHeight;this.scale=this.finalConfiguration.canvasHeight/this.img.height,this.offsetX=0,this.offsetY=0}},init(){this.initParameter(),this.canvasPic=this.$refs["canvas-pic"],this.canvasMasking=this.$refs["canvas-masking"],this.descriptionBox=this.$refs["description-box"],this.contextPic=this.canvasPic.getContext("2d"),this.contextMasking=this.canvasMasking.getContext("2d"),this.img=new Image,this.img.src=this.imgUrl;let t=this;this.canvasMasking.addEventListener("mousemove",(e=>{let i=e.offsetX,n=e.offsetY;t.cursorPosition={x:i,y:n};let a=!1,s=-1;for(let o=0;o<t.allPoints.length;o++)if(d.isPointInPolygon({x:i,y:n},t.allPoints[o],t.scale,t.offsetX,t.offsetY)){a=!0,s=o;break}!t.selecting&&a?(t.selecting=!0,t.selectingIndex=Math.max(0,s),t.cursorPosition={x:i,y:n},t.refreshCanvas()):t.selecting&&a?t.selectingIndex===s||(t.selectingIndex=Math.max(0,s),t.cursorPosition={x:i,y:n},t.refreshCanvas()):t.selecting&&!a?(t.selecting=!1,t.cursorPosition={x:i,y:n},t.refreshCanvas()):t.selecting})),this.img.onload=()=>{t.selfAdaptionImage(),t.applyParameter();let e=this.img.width*this.scale,i=this.img.height*this.scale;t.contextPic.drawImage(t.img,t.offsetX,t.offsetY,e,i),(0,o.nextTick)((()=>{let e=t.$refs["description-box"];e.style.top=this.offsetY+this.img.height*this.scale+"px",e.style.left="0px"}))}},initParameter(){this.finalConfiguration={canvasWidth:this.canvasWidth,canvasHeight:this.canvasHeight,maskBackground:this.maskBackground,animationTime:this.animationTime,showDescriptionBox:this.showDescriptionBox,descriptionBoxStyle:this.descriptionBoxStyle},d.mergeObjects(this.finalConfiguration,p.DefaultConfiguration)},applyParameter(){let t=this.img.width*this.scale,e=this.img.height*this.scale;this.$refs["canvas-pic"].width=t,this.$refs["canvas-pic"].height=e,this.$refs["canvas-masking"].width=t,this.$refs["canvas-masking"].height=e,this.$refs["canvas-box"].style.width=t+"px",this.$refs["canvas-box"].style.height=e+"px",this.$refs["description-box"].style.width=this.img.width*this.scale-32+"px",this.$refs["description-box"].style.minHeight="10px",this.$refs["description-box"].style.background=this.finalConfiguration.descriptionBoxStyle.background,this.$refs["description-box"].style.color=this.finalConfiguration.descriptionBoxStyle.color},focusArea(t,e){const i=document.createElement("canvas"),n=i.getContext("2d");i.width=this.canvasMasking.width,i.height=this.canvasMasking.height,n.fillStyle=this.finalConfiguration.maskBackground,n.fillRect(0,0,this.img.width*this.scale,this.img.height*this.scale),n.fillStyle="rgba(0, 0, 0, 1)",n.globalCompositeOperation="destination-out",n.beginPath(),n.moveTo(t[0].x*this.scale,t[0].y*this.scale);for(let a=1;a<t.length;a++)n.lineTo(t[a].x*this.scale,t[a].y*this.scale);n.closePath(),n.fill(),n.beginPath(),n.arc(this.cursorPosition.x-this.offsetX,this.cursorPosition.y-this.offsetY,Math.max(this.img.width,this.img.height)*this.scale*e,0,2*Math.PI),n.fill(),this.contextMasking.drawImage(i,this.offsetX,this.offsetY)},refreshCanvas(){if(this.contextMasking.clearRect(0,0,this.canvasMasking.width,this.canvasMasking.height),this.timer&&clearInterval(this.timer),this.selecting){let t=this,e=Math.floor(this.finalConfiguration.animationTime),i=0,n=0;t.showDescription(),this.timer=setInterval((function(){let i=Math.max(0,1-n/e);t.contextMasking.clearRect(0,0,t.canvasMasking.width,t.canvasMasking.height),t.focusArea(t.allPoints[t.selectingIndex],i),n++,n>e&&clearInterval(t.timer)}),i)}else{let t=this.offsetY+this.img.height*this.scale;this.$refs["canvas-box"].style.height=t+"px"}this.selecting?this.$emit("selecting",{selectingIndex:this.selectingIndex,points:this.allPoints[this.selectingIndex],areaInfo:this.allAreaInfos[this.selectingIndex]}):this.$emit("unselecting",{})},showDescription(){if(this.finalConfiguration.showDescriptionBox){let t=this;(0,o.nextTick)((()=>{let e=t.$refs["description-box"];e.style.top=this.offsetY+this.img.height*this.scale+"px",e.style.left="0px";const i=4;let n=t.offsetY+t.img.height*t.scale+e.offsetHeight+2*i;t.$refs["canvas-box"].style.height=n+"px"}))}}},mounted(){this.init()},computed:{}},y=m;function v(t,e,i,n,a,s,o,r){var l,c="function"===typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),o?(l=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"===typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),a&&a.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):a&&(l=r?function(){a.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:a),l)if(c.functional){c._injectStyles=l;var h=c.render;c.render=function(t,e){return l.call(e),h(t,e)}}else{var f=c.beforeCreate;c.beforeCreate=f?[].concat(f,l):[l]}return{exports:t,options:c}}var A=v(y,i,s,!1,null,"10308cb9",null),b=A.exports,C=function(){var t=this,e=t._self._c;return e("div",{staticClass:"main"},[e("div",{ref:"drawing-area",staticClass:"drawing-area"},[e("canvas",{ref:"canvas",attrs:{id:"canvas",height:"400",width:"500"}})]),e("div",{ref:"editing-area",staticStyle:{height:"400px",width:"200px","margin-left":"8px",background:"#e8e8e8"}},[e("div",{staticStyle:{padding:"8px"}},[t.drawing||t.editing?t.drawing?e("div",[e("image-spotlight-button",{attrs:{type:"success"},nativeOn:{click:function(e){return t.addArea.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.addArea)+" ")]),e("image-spotlight-button",{attrs:{type:"warning"},nativeOn:{click:function(e){return t.rollBackAreaLatestPoint.apply(null,arguments)}}},[t._v(" "+t._s(t.finalConfiguration.buttonNames.rollBack)+" ")]),e("image-spotlight-button",{nativeOn:{click:function(e){return t.cancelArea.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.cancelArea)+" ")])],1):t.editing?e("div",[e("image-spotlight-button",{attrs:{type:"success"},nativeOn:{click:function(e){return t.confirmChange.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.confirmChange)+" ")]),e("image-spotlight-button",{attrs:{type:"warning"},nativeOn:{click:function(e){return t.deleteArea.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.deleteArea)+" ")]),e("image-spotlight-button",{nativeOn:{click:function(e){return t.cancelChange.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.cancelChange)+" ")])],1):t._e():e("div",[e("image-spotlight-button",{attrs:{type:"success"},nativeOn:{click:function(e){return t.accomplish.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.accomplish)+" ")]),e("image-spotlight-button",{nativeOn:{click:function(e){return t.newArea.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.newArea)+" ")]),e("image-spotlight-button",{nativeOn:{click:function(e){return t.recoverImagePosition.apply(null,arguments)}}},[t._v(t._s(t.finalConfiguration.buttonNames.resetPosition)+" ")])],1)]),e("div",{staticStyle:{margin:"0 8px 8px 8px",background:"white","border-radius":"8px"}},[t.drawing||t.editing?t.drawing||t.editing?e("div",{style:{padding:"8px",width:t.finalConfiguration.editingWidth-16-8-4+"px",height:t.finalConfiguration.height-56-8-4+"px"}},[e("div",{staticStyle:{"text-align":"center","font-weight":"bolder","padding-bottom":"8px"}},[t._v("选区信息")]),e("div",{staticStyle:{"margin-bottom":"8px"}},[t.finalConfiguration.rule.name.required?e("span",{staticStyle:{color:"red"}},[t._v("*")]):t._e(),t._v(" 选区名称 "),t.areaInfoError.name?e("span",{staticStyle:{color:"red","font-size":"small"}},[t._v(t._s(t.finalConfiguration.rule.name.info))]):t._e()]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.areaInfo.name,expression:"areaInfo.name"}],staticClass:"base-input input",style:{marginBottom:"8px",width:t.finalConfiguration.editingWidth-16-8-8-10+"px"},attrs:{placeholder:"请输入选区名称"},domProps:{value:t.areaInfo.name},on:{input:function(e){e.target.composing||t.$set(t.areaInfo,"name",e.target.value)}}}),e("div",{staticStyle:{"margin-bottom":"8px"}},[t.finalConfiguration.rule.description.required?e("span",{staticStyle:{color:"red"}},[t._v("*")]):t._e(),t._v(" 选区描述 "),t.areaInfoError.description?e("span",{staticStyle:{color:"red","font-size":"small"}},[t._v(t._s(t.finalConfiguration.rule.description.info))]):t._e()]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.areaInfo.description,expression:"areaInfo.description"}],staticClass:"base-input textarea",style:{width:t.finalConfiguration.editingWidth-16-8-8-10+"px"},attrs:{rows:Math.floor((t.finalConfiguration.height-56-8-4-108.8-8)/20.8-1),placeholder:"请输入选区描述"},domProps:{value:t.areaInfo.description},on:{input:function(e){e.target.composing||t.$set(t.areaInfo,"description",e.target.value)}}})]):t._e():e("div",[e("div",{ref:"outline-list",staticClass:"outlines-list",style:{background:t.finalConfiguration.areaListBackground,width:t.finalConfiguration.editingWidth-16-8-4+"px",height:t.finalConfiguration.height-56-8+"px"}},[e("div",{ref:"scroll",staticClass:"scroll",style:{width:t.finalConfiguration.editingWidth-16-8-4+"px",height:t.finalConfiguration.height-56-8-4+"px"}},t._l(t.allAreaInfos,(function(i,n){return e("div",{ref:"areaListItem-"+n,refInFor:!0,staticClass:"outlines-item",style:{background:t.finalConfiguration.areaListItemBackground,width:t.finalConfiguration.editingWidth-16-8-8-8+"px"},on:{mouseover:function(e){return t.highlightArea(n)},mouseleave:function(e){return t.recoverArea(n)},click:function(e){return t.editArea(n)}}},[t._v(" "+t._s(i.name)+" ")])})),0)])])])])])},x=[],S=function(){var t=this,e=t._self._c;return e("button",{ref:"button",staticClass:"image-spotlight-button",attrs:{type:"button"}},[t._t("default",(function(){return[e("span",[t._v("按钮")])]}))],2)},w=[],k={name:"ImageSpotlightButton",props:{type:{type:String,default:"default"}},components:{},data(){return{typeStyle:{default:{background:"#FFFFFF",color:"#000000",backgroundAfterHover:"#ECF5FF",colorAfterHover:"#409EFF"},success:{background:"#67C23A",color:"#FFFFFF",backgroundAfterHover:"#95D475",colorAfterHover:"#FFFFFF"},warning:{background:"#E6A23C",color:"#FFFFFF",backgroundAfterHover:"#EEBE77",colorAfterHover:"#FFFFFF"}}}},methods:{},mounted(){let t="default";this.type in this.typeStyle&&(t=this.type);const e=this.$refs.button;e.style.background=this.typeStyle[t].background,e.style.color=this.typeStyle[t].color;let i=this;e.onmouseover=()=>{e.style.background=i.typeStyle[t].backgroundAfterHover,e.style.color=i.typeStyle[t].colorAfterHover},e.onmouseout=function(){e.style.background=i.typeStyle[t].background,e.style.color=i.typeStyle[t].color}},computed:{}},I=k,B=v(I,S,w,!1,null,"09df7450",null),F=B.exports;const O={canvasWidth:500,editingWidth:200,height:400,selectingAreaStyle:{lineColor:"#FF0000",lineWidth:2,pointColor:"#FFFF00",pointRadius:2},drawingAreaStyle:{lineColor:"#0000FF",lineWidth:2,pointColor:"#0000FF",pointRadius:2},otherAreaStyle:{lineColor:"#000000",lineWidth:1,pointColor:"#000000",pointRadius:2},rule:{name:{required:!0,pattern:"^[\\s\\S]*.*[^\\s][\\s\\S]*$",info:"名字不能为空"},description:{required:!1,pattern:"^[\\s\\S]*$",info:""}},backgroundImage:`url(${d.getImage("transparent-background.png")})`,editingAreaBackground:"#E8E8E8",areaListBackground:"#FFFFFF",areaListItemBackground:"#E8E8E8",areaListItemBackgroundAfterHover:"#BDBDBD",buttonNames:{accomplish:"完成",newArea:"新的",resetPosition:"置位",addArea:"确认",cancelArea:"取消",rollBack:"撤回",confirmChange:"确认",cancelChange:"取消",deleteArea:"删除"}};var _={DefaultConfiguration:O},P={name:"ImageSpotlightEditor",components:{ImageSpotlightButton:F},props:{imgUrl:{type:String,required:!0},allPoints:{type:Array,default:()=>[]},allAreaInfos:{type:Array,default:()=>[]},canvasWidth:{type:Number,default:500},editingWidth:{type:Number,default:200},height:{type:Number,default:400},selectingAreaStyle:{type:Object,default:()=>({lineColor:"#FF0000",lineWidth:2,pointColor:"#FFFF00",pointRadius:2})},drawingAreaStyle:{type:Object,default:()=>({lineColor:"#0000FF",lineWidth:2,pointColor:"#0000FF",pointRadius:2})},otherAreaStyle:{type:Object,default:()=>({lineColor:"#000000",lineWidth:1,pointColor:"#000000",pointRadius:2})},rule:{type:Object,default:()=>({name:{required:!0,pattern:"^[\\s\\S]*.*[^\\s][\\s\\S]*$",info:"名字不能为空"},description:{required:!1,pattern:"^[\\s\\S]*$",info:""}})},backgroundImage:{type:String,default:()=>`url(${d.getImage("transparent-background.png")})`},editingAreaBackground:{type:String,default:()=>"#E8E8E8"},areaListBackground:{type:String,default:()=>"#FFFFFF"},areaListItemBackground:{type:String,default:()=>"#E8E8E8"},areaListItemBackgroundAfterHover:{type:String,default:()=>"#BDBDBD"},buttonNames:{type:Object,default:()=>({accomplish:"完成",newArea:"新的",resetPosition:"置位",addArea:"确认",cancelArea:"取消",rollBack:"撤回",confirmChange:"确认",cancelChange:"取消",deleteArea:"删除"})}},data(){return{finalConfiguration:_.DefaultConfiguration,canvas:null,context:null,points:[],areaInfo:{name:"",description:""},areaInfoError:{name:!1,description:!1},areaIndex:0,drawing:0,editing:0,selecting:!1,mouseDown:!1,img:null,scale:1,offsetX:0,offsetY:0,preDownX:0,preDownY:0}},methods:{init(){this.initParameter(),this.applyParameter(),this.canvas=this.$refs.canvas,this.canvas.width=this.finalConfiguration.canvasWidth,this.canvas.height=this.finalConfiguration.height,this.context=this.canvas.getContext("2d");let t=this;this.img=new Image,this.img.src=this.imgUrl,this.canvas.addEventListener("mousedown",(function(e){if(!t.drawing)return;let i=(e.offsetX-t.offsetX)/t.scale,n=(e.offsetY-t.offsetY)/t.scale;i<0||n<0||i>t.img.width||n>t.img.height||(t.points.push({x:i,y:n}),t.refreshCanvas())})),this.canvas.addEventListener("wheel",(function(e){e.preventDefault();let i=e.deltaY>0?-.1:.1,n=e.offsetX,a=e.offsetY,s=e.deltaY>0?.9*t.scale:1.1*t.scale,r=(n-t.offsetX)*i,l=(a-t.offsetY)*i,c=t.offsetX-r,h=t.offsetY-l;t.scale=s,t.offsetX=c,t.offsetY=h,(0,o.nextTick)((()=>{t.refreshCanvas()}))})),this.canvas.addEventListener("mousedown",(function(e){0===e.button&&(t.mouseDown=!0,t.preDownX=e.offsetX,t.preDownY=e.offsetY)})),this.canvas.addEventListener("mouseup",(function(e){0===e.button&&(t.mouseDown=!1)})),this.canvas.addEventListener("mousemove",(function(e){t.mouseDown&&((!t.drawing||Math.abs(t.preDownX-e.offsetX)>=8||Math.abs(t.preDownY-e.offsetY)>=8)&&(t.offsetX+=e.movementX,t.offsetY+=e.movementY),t.refreshCanvas())})),this.canvas.addEventListener("mouseleave",(function(e){0===e.button&&(t.mouseDown=!1)})),this.img.onload=function(){t.initImage(),(0,o.nextTick)((()=>{t.refreshCanvas()}))}},initParameter(){let t=_.DefaultConfiguration;this.finalConfiguration={canvasWidth:this.canvasWidth?this.canvasWidth:this.defaultConfiguration.canvasWidth,editingWidth:this.editingWidth?this.editingWidth:this.defaultConfiguration.editingWidth,height:this.height?this.height:this.defaultConfiguration.height,selectingAreaStyle:{lineColor:d.accessObjectSafely(this.selectingAreaStyle,["lineColor"])?d.accessObjectSafely(this.selectingAreaStyle,["lineColor"]):t.selectingAreaStyle.lineColor,lineWidth:d.accessObjectSafely(this.selectingAreaStyle,["lineWidth"])?d.accessObjectSafely(this.selectingAreaStyle,["lineWidth"]):t.selectingAreaStyle.lineWidth,pointColor:d.accessObjectSafely(this.selectingAreaStyle,["pointColor"])?d.accessObjectSafely(this.selectingAreaStyle,["pointColor"]):t.selectingAreaStyle.pointColor,pointRadius:d.accessObjectSafely(this.selectingAreaStyle,["pointRadius"])?d.accessObjectSafely(this.selectingAreaStyle,["pointRadius"]):t.selectingAreaStyle.pointRadius},drawingAreaStyle:{lineColor:d.accessObjectSafely(this.drawingAreaStyle,["lineColor"])?d.accessObjectSafely(this.drawingAreaStyle,["lineColor"]):t.selectingAreaStyle.lineColor,lineWidth:d.accessObjectSafely(this.drawingAreaStyle,["lineWidth"])?d.accessObjectSafely(this.drawingAreaStyle,["lineWidth"]):t.selectingAreaStyle.lineWidth,pointColor:d.accessObjectSafely(this.drawingAreaStyle,["pointColor"])?d.accessObjectSafely(this.drawingAreaStyle,["pointColor"]):t.selectingAreaStyle.pointColor,pointRadius:d.accessObjectSafely(this.drawingAreaStyle,["pointRadius"])?d.accessObjectSafely(this.drawingAreaStyle,["pointRadius"]):t.selectingAreaStyle.pointRadius},otherAreaStyle:{lineColor:d.accessObjectSafely(this.otherAreaStyle,["lineColor"])?d.accessObjectSafely(this.otherAreaStyle,["lineColor"]):t.selectingAreaStyle.lineColor,lineWidth:d.accessObjectSafely(this.otherAreaStyle,["lineWidth"])?d.accessObjectSafely(this.otherAreaStyle,["lineWidth"]):t.selectingAreaStyle.lineWidth,pointColor:d.accessObjectSafely(this.otherAreaStyle,["pointColor"])?d.accessObjectSafely(this.otherAreaStyle,["pointColor"]):t.selectingAreaStyle.pointColor,pointRadius:d.accessObjectSafely(this.otherAreaStyle,["pointRadius"])?d.accessObjectSafely(this.otherAreaStyle,["pointRadius"]):t.selectingAreaStyle.pointRadius},rule:{name:{required:d.accessObjectSafely(this.rule,["name","required"])?d.accessObjectSafely(this.rule,["name","required"]):t.rule.name.required,pattern:d.accessObjectSafely(this.rule,["name","pattern"])?d.accessObjectSafely(this.rule,["name","pattern"]):t.rule.name.pattern,info:d.accessObjectSafely(this.rule,["name","info"])?d.accessObjectSafely(this.rule,["name","info"]):t.rule.name.info},description:{required:d.accessObjectSafely(this.rule,["description","required"])?d.accessObjectSafely(this.rule,["description","required"]):t.rule.description.required,pattern:d.accessObjectSafely(this.rule,["description","pattern"])?d.accessObjectSafely(this.rule,["description","pattern"]):t.rule.description.pattern,info:d.accessObjectSafely(this.rule,["description","info"])?d.accessObjectSafely(this.rule,["description","info"]):t.rule.description.info}},backgroundImage:this.backgroundImage?this.backgroundImage:t.backgroundImage,editingAreaBackground:this.editingAreaBackground?this.editingAreaBackground:t.editingAreaBackground,areaListBackground:this.areaListBackground?this.areaListBackground:t.areaListBackground,areaListItemBackground:this.areaListItemBackground?this.areaListItemBackground:t.areaListItemBackground,areaListItemBackgroundAfterHover:this.areaListItemBackgroundAfterHover?this.areaListItemBackgroundAfterHover:t.areaListItemBackgroundAfterHover,buttonNames:{accomplish:this.buttonNames&&this.buttonNames.accomplish?this.buttonNames.accomplish:t.buttonNames.accomplish,newArea:this.buttonNames&&this.buttonNames.newArea?this.buttonNames.newArea:t.buttonNames.newArea,resetPosition:this.buttonNames&&this.buttonNames.resetPosition?this.buttonNames.resetPosition:t.buttonNames.resetPosition,addArea:this.buttonNames&&this.buttonNames.addArea?this.buttonNames.addArea:t.buttonNames.addArea,cancelArea:this.buttonNames&&this.buttonNames.cancelArea?this.buttonNames.cancelArea:t.buttonNames.cancelArea,rollBack:this.buttonNames&&this.buttonNames.rollBack?this.buttonNames.rollBack:t.buttonNames.rollBack,confirmChange:this.buttonNames&&this.buttonNames.confirmChange?this.buttonNames.confirmChange:t.buttonNames.confirmChange,cancelChange:this.buttonNames&&this.buttonNames.cancelChange?this.buttonNames.cancelChange:t.buttonNames.cancelChange,deleteArea:this.buttonNames&&this.buttonNames.deleteArea?this.buttonNames.deleteArea:t.buttonNames.deleteArea}}},applyParameter(){this.$refs["drawing-area"].style.height=this.finalConfiguration.height+"px",this.$refs["drawing-area"].style.width=this.finalConfiguration.canvasWidth+"px",this.$refs["drawing-area"].style.backgroundImage=this.finalConfiguration.backgroundImage,this.$refs["editing-area"].style.height=this.finalConfiguration.height+"px",this.$refs["editing-area"].style.width=this.finalConfiguration.editingWidth+"px",this.$refs["editing-area"].style.background=this.finalConfiguration.editingAreaBackground},initImage(){this.selfAdaptionImage()},selfAdaptionImage(){let t=1*this.img.width/this.img.height;if(t>this.finalConfiguration.canvasWidth/this.finalConfiguration.height){let e=this.finalConfiguration.canvasWidth,i=e/t;this.scale=this.finalConfiguration.canvasWidth/this.img.width,this.offsetX=0,this.offsetY=(this.finalConfiguration.height-i)/2}else{let e=this.finalConfiguration.height,i=e*t;this.scale=this.finalConfiguration.height/this.img.height,this.offsetX=(this.finalConfiguration.canvasWidth-i)/2,this.offsetY=0}},refreshCanvas(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawImage(),this.drawAllOutlines(),this.drawAllPoints()},drawImage(){let t=this.img.width*this.scale,e=this.img.height*this.scale;this.context.drawImage(this.img,this.offsetX,this.offsetY,t,e)},drawAllPoints(){for(let t=0;t<this.allPoints.length;t++)this.drawPoints(this.allPoints[t],this.selecting&&this.areaIndex===t,!1);this.drawPoints(this.points,!1,!0)},drawPoints(t,e,i){let n=2;e?(this.context.fillStyle=this.finalConfiguration.selectingAreaStyle.pointColor,n=this.finalConfiguration.selectingAreaStyle.pointRadius):i?(this.context.fillStyle=this.finalConfiguration.drawingAreaStyle.pointColor,n=this.finalConfiguration.drawingAreaStyle.pointRadius):(this.context.fillStyle=this.finalConfiguration.otherAreaStyle.pointColor,n=this.finalConfiguration.otherAreaStyle.pointRadius);for(const a of t)this.context.beginPath(),this.context.arc(a.x*this.scale+this.offsetX,a.y*this.scale+this.offsetY,n,0,2*Math.PI),this.context.fill()},drawAllOutlines(){for(let t=0;t<this.allPoints.length;t++)this.drawOutline(this.allPoints[t],this.selecting&&this.areaIndex===t,!1);this.drawOutline(this.points,!1,!0)},drawOutline(t,e,i){if(e?(this.context.strokeStyle=this.finalConfiguration.selectingAreaStyle.lineColor,this.context.lineWidth=this.finalConfiguration.selectingAreaStyle.lineWidth):i?(this.context.strokeStyle=this.finalConfiguration.drawingAreaStyle.lineColor,this.context.lineWidth=this.finalConfiguration.drawingAreaStyle.lineWidth):(this.context.strokeStyle=this.finalConfiguration.otherAreaStyle.lineColor,this.context.lineWidth=this.finalConfiguration.otherAreaStyle.lineWidth),t.length>1){this.context.beginPath(),this.context.moveTo(t[0].x*this.scale+this.offsetX,t[0].y*this.scale+this.offsetY);for(let e=1;e<t.length;e++)this.context.lineTo(t[e].x*this.scale+this.offsetX,t[e].y*this.scale+this.offsetY);this.context.closePath(),this.context.stroke()}},accomplish(){this.$emit("accomplish",{imgUrl:this.imgUrl,allAreaInfos:this.allAreaInfos,allPoints:this.allPoints})},newArea(){this.drawing=!0,this.areaInfo={name:"",description:""},this.points=[]},addArea(){if(this.points.length<=2)return void alert("请确保选区至少3个点");if(!this.verifyForm())return;this.drawing=!1,this.allPoints.push(this.points),this.allAreaInfos.push(this.areaInfo),this.areaInfo={name:"",description:""},this.points=[];let t=this;(0,o.nextTick)((()=>{t.refreshCanvas()}))},rollBackAreaLatestPoint(){this.points&&this.points.length>=1&&(this.points.splice(this.points.length-1,1),this.refreshCanvas())},cancelArea(){this.drawing=!1,this.areaInfo={name:"",description:""},this.points=[];let t=this;(0,o.nextTick)((()=>{t.refreshCanvas()}))},confirmChange(){if(!this.verifyForm())return;this.allAreaInfos[this.areaIndex]=this.areaInfo,this.editing=!1,this.selecting=!1;let t=this;(0,o.nextTick)((()=>{t.refreshCanvas()}))},cancelChange(){this.editing=!1,this.selecting=!1;let t=this;(0,o.nextTick)((()=>{t.refreshCanvas()}))},deleteArea(){this.allAreaInfos.splice(this.areaIndex,1),this.allPoints.splice(this.areaIndex,1),this.editing=!1,this.selecting=!1;let t=this;(0,o.nextTick)((()=>{t.refreshCanvas()}))},recoverImagePosition(){this.selfAdaptionImage(),this.refreshCanvas()},highlightArea(t){this.$refs["areaListItem-"+t][0].style.background=this.finalConfiguration.areaListItemBackgroundAfterHover,this.selecting=!0,this.areaIndex=t,this.refreshCanvas()},recoverArea(t){this.$refs["areaListItem-"+t][0].style.background=this.finalConfiguration.areaListItemBackground,this.selecting=!1,this.refreshCanvas()},editArea(t){this.areaInfo={...this.allAreaInfos[t]},this.editing=!0,this.selecting=!0,this.areaIndex=t;let e=this;(0,o.nextTick)((()=>{e.refreshCanvas()}))},verifyForm(){return this.finalConfiguration.rule.name.required&&0===this.areaInfo.name.length?(this.areaInfoError.name=!0,!1):new RegExp(this.finalConfiguration.rule.name.pattern).test(this.areaInfo.name)?this.finalConfiguration.rule.description.required&&0===this.areaInfo.description.length?(this.areaInfoError.description=!0,!1):new RegExp(this.finalConfiguration.rule.description.pattern).test(this.areaInfo.description)?(this.areaInfoError.name=!1,this.areaInfoError.description=!1,!0):(this.areaInfoError.description=!0,!1):(this.areaInfoError.name=!0,!1)}},mounted(){this.init()}},j=P,N=v(j,C,x,!1,null,"adf372f8",null),W=N.exports;let E={};const $=[b,W];E.install=function(t){E.installed||(E.installed=!0,$.forEach((e=>{t.component(e.name,e)})))};var R=E,L=R}(),a}()}));
//# sourceMappingURL=vue2-image-spotlight.umd.min.js.map